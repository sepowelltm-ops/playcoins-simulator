<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cases</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    #case-result {
      font-size: 20px;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Cases / Loot Boxes</h1>
  <div id="balance">Coins: 0</div>
  <div id="message"></div>

  <div id="controls">
    <input type="number" id="bet-amount" placeholder="Bet coins" min="1">
    <button id="open-btn">Open Case</button>
  </div>

  <div id="case-result"></div>

  <script>
    const balanceEl = document.getElementById('balance');
    const messageEl = document.getElementById('message');
    const caseResultEl = document.getElementById('case-result');

    const accounts = JSON.parse(localStorage.getItem('accounts')) || {};
    const currentUser = localStorage.getItem('currentUser');

    let playerBalance = currentUser && accounts[currentUser] ? accounts[currentUser].balance : 0;
    updateBalance();

    function updateBalance(){ balanceEl.textContent = `Coins: ${playerBalance}`; }

    document.getElementById('open-btn').onclick = () => {
      if(!currentUser) return alert("Login first!");
      const bet = Number(document.getElementById('bet-amount').value);
      if(!bet || bet>playerBalance) return alert("Invalid bet");

      // ---------------- HEAVILY HOUSE-FAVORED MULTIPLIERS ----------------
      // Most of the pool is low multipliers
      const multipliers = [
        0.5,0.5,0.5,0.5,0.5,0.5,0.5, // 7x 0.5x
        1,1,1,1,                     // 4x 1x
        1.1,1.1,                      // 1x 1.1x
        1.2,                          // 0.75x 1.2x
        1.5,                          // 0.5x 1.5x
        2,                            // 0.02x 2x (rare)
        3                             // 0.001x 3x (very rare)
      ];

      const multiplier = multipliers[Math.floor(Math.random() * multipliers.length)];

      const winnings = Math.floor(bet * multiplier);
      playerBalance -= bet; // remove bet first
      playerBalance += winnings; // add winnings

      accounts[currentUser].balance = playerBalance;
      localStorage.setItem('accounts', JSON.stringify(accounts));

      updateBalance();
      caseResultEl.textContent = `Case opened! Multiplier: x${multiplier.toFixed(2)} â€” Won ${winnings} coins`;
      messageEl.textContent = "Open another case or change your bet.";
    };
  </script>
</body>
</html>

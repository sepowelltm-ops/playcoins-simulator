<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crash</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Crash</h1>

<p>Balance: <span id="balance">0</span> coins</p>

<input type="number" id="betAmount" placeholder="Bet amount" min="1">
<br><br>

<button id="startBtn">Start</button>
<button id="cashoutBtn" disabled>Cash Out</button>

<h2 id="multiplier">1.00x</h2>
<h3 id="status"></h3>

<script src="script.js"></script>
<script>
let crashInterval;
let multiplier = 1.0;
let crashed = false;
let bet = 0;
let crashPoint = 0;

const startBtn = document.getElementById("startBtn");
const cashoutBtn = document.getElementById("cashoutBtn");
const multiplierText = document.getElementById("multiplier");
const statusText = document.getElementById("status");

function getBalance() {
  return parseInt(localStorage.getItem("balance") || "5");
}

function setBalance(amount) {
  localStorage.setItem("balance", amount);
  document.getElementById("balance").textContent = amount;
}

function generateCrashPoint(betAmount) {
  // HOUSE EDGE:
  // Higher bet = lower average crash
  const base = Math.random() * 3 + 1;
  const penalty = Math.min(betAmount / 20, 1.5);
  return Math.max(1.05, base - penalty);
}

startBtn.onclick = () => {
  bet = parseInt(document.getElementById("betAmount").value);
  if (!bet || bet <= 0) return alert("Invalid bet");

  let balance = getBalance();
  if (bet > balance) return alert("Not enough coins");

  // Deduct bet
  setBalance(balance - bet);

  multiplier = 1.0;
  crashed = false;
  crashPoint = generateCrashPoint(bet);

  multiplierText.textContent = "1.00x";
  statusText.textContent = "Running...";
  cashoutBtn.disabled = false;
  startBtn.disabled = true;

  crashInterval = setInterval(() => {
    multiplier += 0.01 + multiplier * 0.002;
    multiplierText.textContent = multiplier.toFixed(2) + "x";

    if (multiplier >= crashPoint) {
      clearInterval(crashInterval);
      crashed = true;
      cashoutBtn.disabled = true;
      startBtn.disabled = false;
      statusText.textContent = "ðŸ’¥ Crashed at " + multiplier.toFixed(2) + "x";
    }
  }, 100);
};

cashoutBtn.onclick = () => {
  if (crashed) return;

  clearInterval(crashInterval);
  cashoutBtn.disabled = true;
  startBtn.disabled = false;

  const win = Math.floor(bet * multiplier);
  setBalance(getBalance() + win);

  statusText.textContent = "ðŸ’° Cashed out at " + multiplier.toFixed(2) + "x (+" + win + ")";
};

document.getElementById("balance").textContent = getBalance();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PlayCoins Simulator</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>PlayCoins Simulator</h1>
  <div id="balance">Coins: 0</div>
  <div id="logged-in-user">Not logged in</div>
</header>

<section class="auth-section">
  <h2>Register</h2>
  <input id="reg-username" placeholder="Username">
  <input id="reg-password" type="password" placeholder="Password">
  <button id="register-btn">Register</button>

  <h2>Login</h2>
  <input id="login-username" placeholder="Username">
  <input id="login-password" type="password" placeholder="Password">
  <button id="login-btn">Login</button>
</section>

<section class="controls">
  <input id="amount" type="number" placeholder="Amount">

  <button id="deposit-btn">Deposit</button>

  <div>
    <p>To withdraw: make a Roblox gamepass with the coin amount and paste the link.</p>
    <input id="withdraw-link" placeholder="Gamepass link">
    <button id="withdraw-btn">Request Withdraw</button>
  </div>
</section>

<section class="games">
  <h2>Games</h2>
  <ul>
    <li><a href="games/blackjack.html">Blackjack</a></li>
    <li><a href="games/crash.html">Crash</a></li>
    <li><a href="games/crossroad.html">Crossroad</a></li>
    <li><a href="games/dice.html">Dice</a></li>
    <li><a href="games/mines.html">Mines</a></li>
    <li><a href="games/cases.html">Cases</a></li>
    <li><a href="games/upgrader.html">Upgrader</a></li>
  </ul>
</section>

<section id="admin-panel" style="display:none;">
  <h2>Admin Panel (FF2DMD)</h2>

  <h3>Pending Deposits</h3>
  <ul id="pending-deposits"></ul>

  <h3>Pending Withdrawals</h3>
  <ul id="pending-withdrawals"></ul>

  <h3>Manual Coin Control</h3>
  <input id="manual-username" placeholder="Username">
  <input id="manual-amount" type="number" placeholder="+ or - amount">
  <button id="manual-add-btn">Apply</button>
</section>

<h2>Transaction Log</h2>
<div id="log"></div>

<script>
/* -------------------- STORAGE HELPERS -------------------- */
function loadAccounts() {
  return JSON.parse(localStorage.getItem("accounts")) || {};
}

function saveAccounts(accounts) {
  localStorage.setItem("accounts", JSON.stringify(accounts));
}

function getCurrentUser() {
  return localStorage.getItem("currentUser");
}

function getUserData(username = getCurrentUser()) {
  const accounts = loadAccounts();
  return accounts[username] || null;
}

/* -------------------- UI HELPERS -------------------- */
function updateBalanceDisplay() {
  const user = getUserData();
  document.getElementById("balance").textContent =
    `Coins: ${user ? user.balance : 0}`;
}

function updateUserDisplay() {
  const user = getCurrentUser();
  document.getElementById("logged-in-user").textContent =
    user ? `Logged in as: ${user}` : "Not logged in";
  document.getElementById("admin-panel").style.display =
    user === "FF2DMD" ? "block" : "none";
}

/* -------------------- LOGGING -------------------- */
function addTransaction(username, type, amount) {
  const accounts = loadAccounts();
  if (!accounts[username]) return;

  accounts[username].transactionLog.push({
    type,
    amount,
    time: new Date().toLocaleString()
  });

  saveAccounts(accounts);
  if (username === getCurrentUser()) renderTransactionLog();
}

function renderTransactionLog() {
  const logEl = document.getElementById("log");
  const user = getUserData();
  if (!user) return;

  logEl.innerHTML = "";
  user.transactionLog.forEach(t => {
    const p = document.createElement("p");
    p.textContent = `[${t.time}] ${t.type}: ${t.amount}`;
    logEl.prepend(p);
  });
}

/* -------------------- REGISTER / LOGIN -------------------- */
document.getElementById("register-btn").onclick = () => {
  const u = regUsername.value.trim();
  const p = regPassword.value.trim();
  if (!u || !p) return alert("Missing fields");

  const accounts = loadAccounts();
  if (accounts[u]) return alert("User exists");

  accounts[u] = { password: p, balance: 5, transactionLog: [] };
  saveAccounts(accounts);
  alert("Registered!");
};

document.getElementById("login-btn").onclick = () => {
  const u = loginUsername.value.trim();
  const p = loginPassword.value.trim();
  const accounts = loadAccounts();

  if (!accounts[u] || accounts[u].password !== p)
    return alert("Invalid login");

  localStorage.setItem("currentUser", u);
  updateUserDisplay();
  updateBalanceDisplay();
  renderTransactionLog();
  renderPendingLists();
};

/* -------------------- DEPOSIT / WITHDRAW -------------------- */
let pendingDeposits = JSON.parse(localStorage.getItem("pendingDeposits")) || [];
let pendingWithdrawals = JSON.parse(localStorage.getItem("pendingWithdrawals")) || [];

depositBtn.onclick = () => {
  const amt = Number(amount.value);
  const user = getCurrentUser();
  if (!user || amt <= 0) return alert("Invalid");

  pendingDeposits.push({ username: user, amount: amt, time: new Date().toLocaleString() });
  localStorage.setItem("pendingDeposits", JSON.stringify(pendingDeposits));
  renderPendingLists();
};

withdrawBtn.onclick = () => {
  const amt = Number(amount.value);
  const link = withdrawLink.value.trim();
  const user = getCurrentUser();

  if (!link || amt <= 0) return alert("Invalid");
  pendingWithdrawals.push({ username: user, amount: amt, link, time: new Date().toLocaleString() });
  localStorage.setItem("pendingWithdrawals", JSON.stringify(pendingWithdrawals));
  renderPendingLists();
};

/* -------------------- ADMIN -------------------- */
function renderPendingLists() {
  if (getCurrentUser() !== "FF2DMD") return;

  pendingDepositsEl.innerHTML = "";
  pendingDeposits.forEach((d, i) => {
    const li = document.createElement("li");
    li.textContent = `${d.username} wants ${d.amount}`;
    const b = document.createElement("button");
    b.textContent = "Approve";
    b.onclick = () => approveDeposit(i);
    li.appendChild(b);
    pendingDepositsEl.appendChild(li);
  });

  pendingWithdrawalsEl.innerHTML = "";
  pendingWithdrawals.forEach((w, i) => {
    const li = document.createElement("li");
    li.textContent = `${w.username} withdraw ${w.amount}`;
    const b = document.createElement("button");
    b.textContent = "Approve";
    b.onclick = () => approveWithdraw(i);
    li.appendChild(b);
    pendingWithdrawalsEl.appendChild(li);
  });
}

function approveDeposit(i) {
  const d = pendingDeposits[i];
  const accounts = loadAccounts();
  accounts[d.username].balance += d.amount;
  addTransaction(d.username, "Deposit Approved", d.amount);
  saveAccounts(accounts);

  pendingDeposits.splice(i, 1);
  localStorage.setItem("pendingDeposits", JSON.stringify(pendingDeposits));
  renderPendingLists();
  updateBalanceDisplay();
}

function approveWithdraw(i) {
  const w = pendingWithdrawals[i];
  const accounts = loadAccounts();
  accounts[w.username].balance -= w.amount;
  addTransaction(w.username, "Withdraw Approved", w.amount);
  saveAccounts(accounts);

  pendingWithdrawals.splice(i, 1);
  localStorage.setItem("pendingWithdrawals", JSON.stringify(pendingWithdrawals));
  renderPendingLists();
  updateBalanceDisplay();
}

manualAddBtn.onclick = () => {
  if (getCurrentUser() !== "FF2DMD") return;

  const u = manualUsername.value.trim();
  const amt = Number(manualAmount.value);
  const accounts = loadAccounts();

  if (!accounts[u]) return alert("User not found");

  accounts[u].balance += amt;
  addTransaction(u, amt > 0 ? "Admin Add" : "Admin Remove", amt);
  saveAccounts(accounts);
  updateBalanceDisplay();
};

updateUserDisplay();
updateBalanceDisplay();
renderTransactionLog();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PlayCoins Simulator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>PlayCoins Simulator</h1>
    <div id="balance">Coins: 5</div>
    <div id="logged-in-user">Not logged in</div>
  </header>

  <!-- Login / Register Section -->
  <section class="auth-section">
    <h2>Register / Login</h2>

    <!-- Register -->
    <input id="reg-username" placeholder="Username" />
    <input id="reg-password" type="password" placeholder="Password" />
    <button id="register-btn">Register</button>
    <br><br>

    <!-- Login -->
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <button id="login-btn">Login</button>
  </section>

  <!-- Deposit / Withdraw -->
  <section class="controls">
    <input id="amount" type="number" placeholder="Amount" />
    <button id="deposit-btn">Deposit</button>
    <button id="withdraw-btn">Withdraw</button>
  </section>

  <!-- Games -->
  <section class="games">
    <h2>Games</h2>
    <ul>
      <li><a href="games/blackjack.html">Blackjack</a></li>
      <li><a href="games/crash.html">Crash</a></li>
      <li><a href="games/crossroad.html">Crossroad</a></li>
      <li><a href="games/dice.html">Dice</a></li>
      <li><a href="games/mines.html">Mines</a></li>
      <li><a href="games/cases.html">Cases</a></li>
      <li><a href="games/upgrader.html">Upgrader</a></li>
    </ul>
  </section>

  <!-- Admin Panel (hidden unless FF2DMD) -->
  <section class="admin-section" id="admin-panel" style="display:none;">
    <h2>Admin: Add Coins to User</h2>
    <input id="admin-username" placeholder="Username" />
    <input id="admin-amount" type="number" placeholder="Amount" />
    <button id="admin-add-btn">Add Coins</button>
  </section>

  <!-- Transaction Logs -->
  <div id="log"></div>

  <!-- Scripts -->
  <script src="script.js"></script>
  <script>
    // ----------------------------
    // LOGIN / REGISTER SYSTEM
    // ----------------------------
    const registerBtn = document.getElementById('register-btn');
    const loginBtn = document.getElementById('login-btn');
    const regUsernameEl = document.getElementById('reg-username');
    const regPasswordEl = document.getElementById('reg-password');
    const loginUsernameEl = document.getElementById('login-username');
    const loginPasswordEl = document.getElementById('login-password');
    const loggedInUserEl = document.getElementById('logged-in-user');

    let currentUser = localStorage.getItem('currentUser') || null;
    let accounts = JSON.parse(localStorage.getItem('accounts')) || {};

    function updateLoggedInDisplay() {
      loggedInUserEl.textContent = currentUser ? `Logged in as: ${currentUser}` : "Not logged in";

      // Show admin panel only for FF2DMD
      const adminPanel = document.getElementById('admin-panel');
      if (currentUser === "FF2DMD") {
        adminPanel.style.display = "block";
      } else {
        adminPanel.style.display = "none";
      }
    }

    // Register
    registerBtn.addEventListener('click', () => {
      const username = regUsernameEl.value.trim();
      const password = regPasswordEl.value.trim();
      if (!username || !password) return alert("Enter both username and password");
      if (accounts[username]) return alert("Username already exists");

      accounts[username] = { password, balance: 5, transactionLog: [] };
      localStorage.setItem('accounts', JSON.stringify(accounts));
      alert(`Account ${username} registered! You can now login.`);
      regUsernameEl.value = '';
      regPasswordEl.value = '';
    });

    // Login
    loginBtn.addEventListener('click', () => {
      const username = loginUsernameEl.value.trim();
      const password = loginPasswordEl.value.trim();
      if (!username || !password) return alert("Enter both username and password");
      if (!accounts[username]) return alert("Account does not exist");
      if (accounts[username].password !== password) return alert("Incorrect password");

      currentUser = username;
      localStorage.setItem('currentUser', currentUser);
      updateLoggedInDisplay();
      alert(`Logged in as ${username}`);
      loginUsernameEl.value = '';
      loginPasswordEl.value = '';
      updateBalanceDisplay();
      renderTransactionLog();
    });

    updateLoggedInDisplay();

    // ----------------------------
    // BALANCE & TRANSACTIONS
    // ----------------------------
    const balanceEl = document.getElementById('balance');
    const amountEl = document.getElementById('amount');
    const logEl = document.getElementById('log');

    function getUserData() {
      if (!currentUser) return null;
      accounts = JSON.parse(localStorage.getItem('accounts')) || {};
      return accounts[currentUser];
    }

    function updateBalanceDisplay() {
      const userData = getUserData();
      if (!userData) {
        balanceEl.textContent = "Coins: 0";
        return;
      }
      balanceEl.textContent = `Coins: ${userData.balance}`;
    }

    function renderTransactionLog() {
      const userData = getUserData();
      if (!userData) return;
      logEl.innerHTML = '';
      userData.transactionLog.forEach(t => {
        const p = document.createElement('p');
        p.textContent = `[${t.time}] ${t.type}: ${t.amount} coins (User: ${currentUser})`;
        logEl.prepend(p);
      });
    }

    function addTransaction(type, amount) {
      const userData = getUserData();
      if (!userData) return;
      const time = new Date().toLocaleString();
      userData.transactionLog.push({ type, amount, time });
      accounts[currentUser] = userData;
      localStorage.setItem('accounts', JSON.stringify(accounts));
      renderTransactionLog();
    }

    // Deposit
    document.getElementById('deposit-btn').addEventListener('click', () => {
      const userData = getUserData();
      if (!userData) return alert("Please login first!");
      const amount = Number(amountEl.value);
      if (!amount || amount <= 0) return alert("Enter valid amount");
      userData.balance += amount;
      accounts[currentUser] = userData;
      localStorage.setItem('accounts', JSON.stringify(accounts));
      addTransaction("Deposit", amount);
      updateBalanceDisplay();
      amountEl.value = '';
    });

    // Withdraw
    document.getElementById('withdraw-btn').addEventListener('click', () => {
      const userData = getUserData();
      if (!userData) return alert("Please login first!");
      const amount = Number(amountEl.value);
      if (!amount || amount <= 0) return alert("Enter valid amount");
      if (amount > userData.balance) return alert("Not enough coins");
      userData.balance -= amount;
      accounts[currentUser] = userData;
      localStorage.setItem('accounts', JSON.stringify(accounts));
      addTransaction("Withdraw", amount);
      updateBalanceDisplay();
      amountEl.value = '';
    });

    updateBalanceDisplay();
    renderTransactionLog();

    // ----------------------------
    // ADMIN PANEL (FF2DMD ONLY)
    // ----------------------------
    const adminAddBtn = document.getElementById('admin-add-btn');
    const adminUsernameEl = document.getElementById('admin-username');
    const adminAmountEl = document.getElementById('admin-amount');

    adminAddBtn.addEventListener('click', () => {
      if (currentUser !== "FF2DMD") return alert("You cannot use this panel");

      const targetUser = adminUsernameEl.value.trim();
      const amount = Number(adminAmountEl.value);
      if (!targetUser || !amount || amount <= 0) return alert("Enter valid username and amount");

      if (!accounts[targetUser]) return alert("User does not exist");

      accounts[targetUser].balance += amount;
      const time = new Date().toLocaleString();
      accounts[targetUser].transactionLog.push({ type: "Admin Add", amount, time });
      localStorage.setItem('accounts', JSON.stringify(accounts));

      alert(`Added ${amount} coins to ${targetUser}`);

      // Update display if current user is the one updated
      if (currentUser === targetUser) updateBalanceDisplay();
      renderTransactionLog();

      adminUsernameEl.value = '';
      adminAmountEl.value = '';
    });
  </script>
</body>
</html>
